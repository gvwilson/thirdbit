<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel="me" href="https://mastodon.social/@gvwilson">
<link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.ico">
<link rel="alternate" type="application/atom+xml" title="The Third Bit" href="../../../../atom.xml">
<!-- <script defer data-domain="third-bit.com" src="https://plausible.io/js/plausible.js"></script> -->
    <script src="https://kit.fontawesome.com/4eee35f757.js"></script>
    <link rel="stylesheet" href="../../../../assets/thirdbit.css">
    <link rel="stylesheet" href="../../../../assets/page.css">
    
<title>The Third Bit: Starting to Simulate</title>

    
  </head>
  <body>
    <nav>
  <div class="row underline">
    <div class="col-2 left">
      <a class="navlink" href="../../../../">Home</a>
    </div>
    <div class="col-10 right">
      <a class="navlink" href="../../../../about/">about</a>
      <a class="navlink" href="../../../../blog/">blog</a>
      <a class="navlink" href="../../../../selected/">selected</a>
      <a class="navlink" href="../../../../talks/">talks</a>
      <a class="navlink" href="../../../../bib/">bibliography</a>
      <a class="navlink" href="../../../../fiction/">fiction</a>
    </div>
  </div>
</nav>
    <main>
      
<h1>Starting to Simulate</h1>


<div class="row">
  <div class="col-2 left">
    
      <a href="../../../../2025/11/11/end-of-life-ideas/">
        &lArr; <span class="pagination-text">previous</span>
      </a>
    
  </div>
  <div class="col-8 center">
    Posted <time datetime="2025-11-18" class="post-date">2025-11-18</time>
  </div>
  <div class="col-2 right">
    
      <a href="../../../../2025/11/19/simulating-a-developer-pool/">
        <span class="pagination-text">next</span> &rArr;
      </a>
    
  </div>
</div>
<!-- content --><p>Inspired in part by <a href="https://sim.curiousduck.io/">the software development simulator</a>
that Elisabeth Hendrickson and friends built,
I&rsquo;ve been toying with the idea of using <a href="https://simpy.readthedocs.io/">SimPy</a> to create something
that could be used in a half-day workshop to
(a) show people how powerful discrete event simulation can be, and
(b) demonstrate why simple measurements of developers&rsquo; work are almost always misleading.
It&rsquo;s been thirty-five years since I did this kind of simulation,
SimPy uses some features of Python that I haven&rsquo;t kept up with,
and I&rsquo;ve never taught this topic before,
so I&rsquo;m planning to do a few blog posts about how it works and what I&rsquo;m learning.</p>
<h2>Generators</h2>
<p>A <em>generator</em> is a Python function that creates an object
which uses its stack to maintain persistent state.
That probably doesn&rsquo;t make any sense unless you already understand it,
so here&rsquo;s an example:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gen_char_from_string</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>
<p>The magic is the keyword <code>yield</code>,
which tells Python that this function creates a generator.
(I think the code would be easier to understand
if a keyword like <code>gen</code> had to be used instead of <code>def</code>,
but that ship sailed a long time ago.)
We can use our generator like this:</p>
<div class="highlight"><pre><span></span><code><span class="n">gen</span> <span class="o">=</span> <span class="n">gen_char_from_string</span><span class="p">(</span><span class="s2">&quot;one&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ended by exception&quot;</span><span class="p">)</span>
</code></pre></div>
<p>As this code shows,
calling <code>gen_char_from_string</code> creates an object rather than immediately returning a value.
Each time we call <code>next</code> on that object,
it advances to the next <code>yield</code>.
The generator object preserves its stack,
so the local variables <code>text</code> and <code>i</code> persist from one invocation to the next.
When execution reaches the end of the generator,
Python thows a <code>StopIteration</code> exception to tell us it&rsquo;s done.</p>
<p>Why go to all this trouble?
First,
<code>for</code> loops understand how to interact with generators,
so we can rewrite the snippets above as:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gen_char_from_string</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">ch</span>

<span class="n">characters</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">gen_char_from_string</span><span class="p">(</span><span class="s2">&quot;two&quot;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;result as list: </span><span class="si">{</span><span class="n">characters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Second,
we can do things like create &ldquo;infinite&rdquo; generators:</p>
<p><div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gen_infinite</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">text</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>


<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gen_infinite</span><span class="p">(</span><span class="s2">&quot;three&quot;</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>0 t
1 h
2 r
3 e
4 e
5 t
6 h
7 r
8 e
9 e
</code></pre></div></p>
<p>or generate the cross-product of two arbitrary collections:</p>
<p><div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gen_combinations</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">left_item</span> <span class="ow">in</span> <span class="n">left</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">right_item</span> <span class="ow">in</span> <span class="n">right</span><span class="p">:</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">left_item</span><span class="p">,</span> <span class="n">right_item</span><span class="p">)</span>


<span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">gen_combinations</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>(&#39;a&#39;, 1)
(&#39;a&#39;, 2)
(&#39;a&#39;, 3)
(&#39;b&#39;, 1)
(&#39;b&#39;, 2)
(&#39;b&#39;, 3)
(&#39;c&#39;, 1)
(&#39;c&#39;, 2)
(&#39;c&#39;, 3)
</code></pre></div></p>
<p>We can even store our generators in a list (after all, they&rsquo;re just objects)
and then use them however we want:</p>
<p><div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">alternate</span><span class="p">(</span><span class="n">processes</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
                <span class="k">yield</span> <span class="nb">next</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">break</span>

<span class="k">def</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">v</span>

<span class="n">sequences</span> <span class="o">=</span> <span class="p">[</span><span class="n">seq</span><span class="p">(</span><span class="s2">&quot;ab&quot;</span><span class="p">),</span> <span class="n">seq</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">alternate</span><span class="p">(</span><span class="n">sequences</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>a
1
b
2
</code></pre></div></p>
<h2>Discrete Event Simulation</h2>
<p><em>Discrete event simulation</em> models a system as a series of events,
each of which occurs at a particular instant in time.
We can simulate such a system by advancing the clock one tick at a time,
but it&rsquo;s more efficient to have each <em>process</em> tell us when it&rsquo;s next going to do something
and then jump ahead to the least of those times.</p>
<blockquote>
<p>Note: we&rsquo;re using the word &ldquo;process&rdquo; to mean &ldquo;something active&rdquo;
rather than &ldquo;an operating system process&rdquo;.
I prefer the word &ldquo;actor&rdquo;,
but &ldquo;process&rdquo; is pretty deeply embedded in discrete event simulation terminology.</p>
</blockquote>
<p>SimPy handles all these details for us.
All we have to do is:</p>
<ol>
<li>Create an <em>environment</em> that stores all the SimPy-ish stuff
    like the list of running processes.</li>
<li>Give it some processes to run.</li>
<li>Tell it to run the simulation until all the processes are done.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">simpy</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">worker</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">worker_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_jobs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">job_time</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">worker</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">worker_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_jobs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">job_time</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation completed at T=</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The key thing here is that <code>worker</code> <em>isn&rsquo;t</em> a normal function call.
Instead of handing a value to <code>env.process</code>,
it creates a generator for the environment to run.
That generator yields <code>env.timeout(delay)</code> to tell SimPy
that it wants to wait for a certain length of time,
e.g.,
to simulate being busy.
(Processes can yield other things as well—we&rsquo;ll see some in future posts.)</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">worker</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">,</span> <span class="n">num_jobs</span><span class="p">,</span> <span class="n">job_time</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Actor with fixed-time jobs.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T=</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2"> worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> starts&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">job_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_jobs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T=</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2"> worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> starts job </span><span class="si">{</span><span class="n">job_num</span><span class="si">}</span><span class="s2"> duration </span><span class="si">{</span><span class="n">job_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">job_time</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T=</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2"> worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> finishes job </span><span class="si">{</span><span class="n">job_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T=</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2"> worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2"> finishes&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Here&rsquo;s the output:</p>
<div class="highlight"><pre><span></span><code>T=0 worker 1 starts
T=0 worker 1 starts job 0 duration 2
T=0 worker 2 starts
T=0 worker 2 starts job 0 duration 3
T=2 worker 1 finishes job 0
T=2 worker 1 starts job 1 duration 2
T=3 worker 2 finishes job 0
T=3 worker 2 starts job 1 duration 3
T=4 worker 1 finishes job 1
T=4 worker 1 starts job 2 duration 2
T=6 worker 2 finishes job 1
T=6 worker 2 starts job 2 duration 3
T=6 worker 1 finishes job 2
T=6 worker 1 finishes
T=9 worker 2 finishes job 2
T=9 worker 2 finishes
Simulation completed at T=9
</code></pre></div>
<h2>Next Steps</h2>
<p>A couple of workers doing fixed-size jobs, completely independently,
isn&rsquo;t a particularly interesting scenario.
The next post in this series will look at two things:</p>
<ol>
<li>How do we make a more realistic simulation?</li>
<li>How do we create more comprehensible output?</li>
</ol>
<p>These questions are equally important because
there&rsquo;s no point building something whose results we can&rsquo;t understand (and check).
Stay tuned…</p><!-- /content -->

    </main>
    <footer>
  &copy; 2004-2026 <a href="../../../../about/">Greg Wilson</a>
  <a href="mailto:gvwilson@third-bit.com"><img src="../../../../assets/icons/envelope.svg" alt="email" class="footer-icon"></a>
  <a href="https://www.linkedin.com/in/gvwilson/"><img src="../../../../assets/icons/linkedin.svg" alt="LinkedIn" class="footer-icon"></a>
  <a href="https://mastodon.social/@gvwilson"><img src="../../../../assets/icons/mastodon.svg" alt="Mastodon" class="footer-icon"></a>
  <!-- <a href="https://calendly.com/gvwilson/30min"><img src="../../../../assets/icons/calendar.svg" alt="Calendly" class="footer-icon"></a> -->
  <a href="https://github.com/gvwilson"><img src="../../../../assets/icons/github.svg" alt="GitHub" class="footer-icon"></a>
  <a href="https://www.youtube.com/channel/UCbDQ7FIeYB3FHRADAjUjfrg"><img src="../../../../assets/icons/youtube.svg" alt="YouTube" class="footer-icon"></a>
  <a href="../../../../bib/"><img src="../../../../assets/icons/orcid.svg" alt="ORCID" class="footer-icon"></a>
  <a href="../../../../atom.xml"><img src="../../../../assets/icons/rss.svg" alt="RSS feed" class="footer-icon"></a>
  <a href="../../../../license/"><img src="../../../../assets/icons/cc-by.svg" alt="license" class="footer-icon"></a>
  <a href="../../../../colophon/"><img src="../../../../assets/icons/pencil.svg" alt="colophon" class="footer-icon"></a>
  <a href="../../../../cv/"><img src="../../../../assets/icons/file.svg" alt="CV" class="footer-icon"></a>
  <br>
  The material on this site may not be used to train AI models without the express permission of the author.
</footer>
  </body>
</html>