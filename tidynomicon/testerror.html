<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Testing and Error Handling | The Tidynomicon</title>
  <meta name="description" content="Chapter 8 Testing and Error Handling | The Tidynomicon" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Testing and Error Handling | The Tidynomicon" />
  <meta property="og:type" content="book" />
  
  <meta name="github-repo" content="gvwilson/tidynomicon" />

  
  

<meta name="author" content="Greg Wilson" />


<meta name="date" content="2021-01-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="debt.html"/>
<link rel="next" href="advanced.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The Tidynomicon</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#s:index-personas"><i class="fa fa-check"></i><b>1.1</b> Who are these lessons for?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#s:index-install"><i class="fa fa-check"></i><b>1.2</b> How do I get started?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basics.html"><a href="basics.html"><i class="fa fa-check"></i><b>2</b> Simple Beginnings</a><ul>
<li class="chapter" data-level="2.1" data-path="basics.html"><a href="basics.html#learning-objectives"><i class="fa fa-check"></i><b>2.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="basics.html"><a href="basics.html#how-do-i-say-hello"><i class="fa fa-check"></i><b>2.2</b> How do I say hello?</a></li>
<li class="chapter" data-level="2.3" data-path="basics.html"><a href="basics.html#how-do-i-add-numbers"><i class="fa fa-check"></i><b>2.3</b> How do I add numbers?</a></li>
<li class="chapter" data-level="2.4" data-path="basics.html"><a href="basics.html#how-do-i-store-many-numbers-together"><i class="fa fa-check"></i><b>2.4</b> How do I store many numbers together?</a></li>
<li class="chapter" data-level="2.5" data-path="basics.html"><a href="basics.html#how-do-i-index-a-vector"><i class="fa fa-check"></i><b>2.5</b> How do I index a vector?</a></li>
<li class="chapter" data-level="2.6" data-path="basics.html"><a href="basics.html#how-do-i-create-new-vectors-from-old"><i class="fa fa-check"></i><b>2.6</b> How do I create new vectors from old?</a></li>
<li class="chapter" data-level="2.7" data-path="basics.html"><a href="basics.html#how-else-does-r-represent-the-absence-of-data"><i class="fa fa-check"></i><b>2.7</b> How else does R represent the absence of data?</a></li>
<li class="chapter" data-level="2.8" data-path="basics.html"><a href="basics.html#how-can-i-store-a-mix-of-different-types-of-objects"><i class="fa fa-check"></i><b>2.8</b> How can I store a mix of different types of objects?</a></li>
<li class="chapter" data-level="2.9" data-path="basics.html"><a href="basics.html#what-is-the-difference-between-and"><i class="fa fa-check"></i><b>2.9</b> What is the difference between <code>[</code> and <code>[[</code>?</a></li>
<li class="chapter" data-level="2.10" data-path="basics.html"><a href="basics.html#how-can-i-access-elements-by-name"><i class="fa fa-check"></i><b>2.10</b> How can I access elements by name?</a></li>
<li class="chapter" data-level="2.11" data-path="basics.html"><a href="basics.html#how-can-i-create-and-index-a-matrix"><i class="fa fa-check"></i><b>2.11</b> How can I create and index a matrix?</a></li>
<li class="chapter" data-level="2.12" data-path="basics.html"><a href="basics.html#how-do-i-choose-and-repeat-things"><i class="fa fa-check"></i><b>2.12</b> How do I choose and repeat things?</a></li>
<li class="chapter" data-level="2.13" data-path="basics.html"><a href="basics.html#how-can-i-vectorize-loops-and-conditionals"><i class="fa fa-check"></i><b>2.13</b> How can I vectorize loops and conditionals?</a></li>
<li class="chapter" data-level="2.14" data-path="basics.html"><a href="basics.html#how-can-i-express-a-range-of-values"><i class="fa fa-check"></i><b>2.14</b> How can I express a range of values?</a></li>
<li class="chapter" data-level="2.15" data-path="basics.html"><a href="basics.html#how-can-i-use-a-vector-in-a-conditional-statement"><i class="fa fa-check"></i><b>2.15</b> How can I use a vector in a conditional statement?</a></li>
<li class="chapter" data-level="2.16" data-path="basics.html"><a href="basics.html#how-do-i-create-and-call-functions"><i class="fa fa-check"></i><b>2.16</b> How do I create and call functions?</a></li>
<li class="chapter" data-level="2.17" data-path="basics.html"><a href="basics.html#how-can-i-write-a-function-that-takes-variable-arguments"><i class="fa fa-check"></i><b>2.17</b> How can I write a function that takes variable arguments?</a></li>
<li class="chapter" data-level="2.18" data-path="basics.html"><a href="basics.html#how-can-i-provide-default-values-for-arguments"><i class="fa fa-check"></i><b>2.18</b> How can I provide default values for arguments?</a></li>
<li class="chapter" data-level="2.19" data-path="basics.html"><a href="basics.html#how-can-i-hide-the-value-that-r-returns"><i class="fa fa-check"></i><b>2.19</b> How can I hide the value that R returns?</a></li>
<li class="chapter" data-level="2.20" data-path="basics.html"><a href="basics.html#how-can-i-assign-to-a-global-variable-from-inside-a-function"><i class="fa fa-check"></i><b>2.20</b> How can I assign to a global variable from inside a function?</a></li>
<li class="chapter" data-level="2.21" data-path="basics.html"><a href="basics.html#key-points"><i class="fa fa-check"></i><b>2.21</b> Key Points</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidyverse.html"><a href="tidyverse.html"><i class="fa fa-check"></i><b>3</b> The Tidyverse</a><ul>
<li class="chapter" data-level="3.1" data-path="tidyverse.html"><a href="tidyverse.html#learning-objectives-1"><i class="fa fa-check"></i><b>3.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="tidyverse.html"><a href="tidyverse.html#how-do-i-read-data"><i class="fa fa-check"></i><b>3.2</b> How do I read data?</a></li>
<li class="chapter" data-level="3.3" data-path="tidyverse.html"><a href="tidyverse.html#how-do-i-inspect-data"><i class="fa fa-check"></i><b>3.3</b> How do I inspect data?</a></li>
<li class="chapter" data-level="3.4" data-path="tidyverse.html"><a href="tidyverse.html#how-do-i-index-rows-and-columns"><i class="fa fa-check"></i><b>3.4</b> How do I index rows and columns?</a></li>
<li class="chapter" data-level="3.5" data-path="tidyverse.html"><a href="tidyverse.html#how-do-i-calculate-basic-statistics"><i class="fa fa-check"></i><b>3.5</b> How do I calculate basic statistics?</a></li>
<li class="chapter" data-level="3.6" data-path="tidyverse.html"><a href="tidyverse.html#how-do-i-filter-data"><i class="fa fa-check"></i><b>3.6</b> How do I filter data?</a></li>
<li class="chapter" data-level="3.7" data-path="tidyverse.html"><a href="tidyverse.html#how-do-i-write-tidy-code"><i class="fa fa-check"></i><b>3.7</b> How do I write tidy code?</a></li>
<li class="chapter" data-level="3.8" data-path="tidyverse.html"><a href="tidyverse.html#how-do-i-model-my-data"><i class="fa fa-check"></i><b>3.8</b> How do I model my data?</a></li>
<li class="chapter" data-level="3.9" data-path="tidyverse.html"><a href="tidyverse.html#how-do-i-create-a-plot"><i class="fa fa-check"></i><b>3.9</b> How do I create a plot?</a></li>
<li class="chapter" data-level="3.10" data-path="tidyverse.html"><a href="tidyverse.html#do-i-need-more-practice-with-the-tidyverse"><i class="fa fa-check"></i><b>3.10</b> Do I need more practice with the tidyverse?</a></li>
<li class="chapter" data-level="3.11" data-path="tidyverse.html"><a href="tidyverse.html#key-points-1"><i class="fa fa-check"></i><b>3.11</b> Key Points</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>4</b> Creating Reports</a><ul>
<li class="chapter" data-level="4.1" data-path="rmarkdown.html"><a href="rmarkdown.html#learning-objectives-2"><i class="fa fa-check"></i><b>4.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="rmarkdown.html"><a href="rmarkdown.html#how-can-i-create-and-preview-a-simple-page"><i class="fa fa-check"></i><b>4.2</b> How can I create and preview a simple page?</a></li>
<li class="chapter" data-level="4.3" data-path="rmarkdown.html"><a href="rmarkdown.html#how-can-i-run-code-and-include-its-output-in-a-page"><i class="fa fa-check"></i><b>4.3</b> How can I run code and include its output in a page?</a></li>
<li class="chapter" data-level="4.4" data-path="rmarkdown.html"><a href="rmarkdown.html#how-can-i-format-tables-in-a-page"><i class="fa fa-check"></i><b>4.4</b> How can I format tables in a page?</a></li>
<li class="chapter" data-level="4.5" data-path="rmarkdown.html"><a href="rmarkdown.html#how-can-i-share-code-between-pages"><i class="fa fa-check"></i><b>4.5</b> How can I share code between pages?</a></li>
<li class="chapter" data-level="4.6" data-path="rmarkdown.html"><a href="rmarkdown.html#how-can-i-parameterize-documents"><i class="fa fa-check"></i><b>4.6</b> How can I parameterize documents?</a></li>
<li class="chapter" data-level="4.7" data-path="rmarkdown.html"><a href="rmarkdown.html#how-can-i-publish-pages-on-github"><i class="fa fa-check"></i><b>4.7</b> How can I publish pages on GitHub?</a></li>
<li class="chapter" data-level="4.8" data-path="rmarkdown.html"><a href="rmarkdown.html#key-points-2"><i class="fa fa-check"></i><b>4.8</b> Key Points</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="package.html"><a href="package.html"><i class="fa fa-check"></i><b>5</b> Creating Packages</a><ul>
<li class="chapter" data-level="5.1" data-path="package.html"><a href="package.html#learning-objectives-3"><i class="fa fa-check"></i><b>5.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="package.html"><a href="package.html#what-is-our-starting-point"><i class="fa fa-check"></i><b>5.2</b> What is our starting point?</a></li>
<li class="chapter" data-level="5.3" data-path="package.html"><a href="package.html#how-do-i-convert-values-to-numbers"><i class="fa fa-check"></i><b>5.3</b> How do I convert values to numbers?</a></li>
<li class="chapter" data-level="5.4" data-path="package.html"><a href="package.html#how-do-i-reorganize-the-columns"><i class="fa fa-check"></i><b>5.4</b> How do I reorganize the columns?</a></li>
<li class="chapter" data-level="5.5" data-path="package.html"><a href="package.html#how-do-i-create-a-package"><i class="fa fa-check"></i><b>5.5</b> How do I create a package?</a></li>
<li class="chapter" data-level="5.6" data-path="package.html"><a href="package.html#how-can-i-document-the-contents-of-a-package"><i class="fa fa-check"></i><b>5.6</b> How can I document the contents of a package?</a></li>
<li class="chapter" data-level="5.7" data-path="package.html"><a href="package.html#how-can-my-package-import-what-it-needs"><i class="fa fa-check"></i><b>5.7</b> How can my package import what it needs?</a></li>
<li class="chapter" data-level="5.8" data-path="package.html"><a href="package.html#how-can-i-add-data-to-a-package"><i class="fa fa-check"></i><b>5.8</b> How can I add data to a package?</a></li>
<li class="chapter" data-level="5.9" data-path="package.html"><a href="package.html#key-points-3"><i class="fa fa-check"></i><b>5.9</b> Key Points</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nse.html"><a href="nse.html"><i class="fa fa-check"></i><b>6</b> Non-Standard Evaluation</a><ul>
<li class="chapter" data-level="6.1" data-path="nse.html"><a href="nse.html#learning-objectives-4"><i class="fa fa-check"></i><b>6.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="nse.html"><a href="nse.html#how-does-python-evaluate-function-calls"><i class="fa fa-check"></i><b>6.2</b> How does Python evaluate function calls?</a></li>
<li class="chapter" data-level="6.3" data-path="nse.html"><a href="nse.html#how-does-r-evaluate-function-calls"><i class="fa fa-check"></i><b>6.3</b> How does R evaluate function calls?</a></li>
<li class="chapter" data-level="6.4" data-path="nse.html"><a href="nse.html#why-is-lazy-evaluation-useful"><i class="fa fa-check"></i><b>6.4</b> Why is lazy evaluation useful?</a></li>
<li class="chapter" data-level="6.5" data-path="nse.html"><a href="nse.html#what-is-tidy-evaluation"><i class="fa fa-check"></i><b>6.5</b> What is tidy evaluation?</a></li>
<li class="chapter" data-level="6.6" data-path="nse.html"><a href="nse.html#what-if-i-truly-desire-to-venture-into-the-depths"><i class="fa fa-check"></i><b>6.6</b> What if I truly desire to venture into the depths?</a></li>
<li class="chapter" data-level="6.7" data-path="nse.html"><a href="nse.html#is-it-worth-it"><i class="fa fa-check"></i><b>6.7</b> Is it worth it?</a></li>
<li class="chapter" data-level="6.8" data-path="nse.html"><a href="nse.html#key-points-4"><i class="fa fa-check"></i><b>6.8</b> Key Points</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="debt.html"><a href="debt.html"><i class="fa fa-check"></i><b>7</b> Intellectual Debt</a><ul>
<li class="chapter" data-level="7.1" data-path="debt.html"><a href="debt.html#learning-objectives-5"><i class="fa fa-check"></i><b>7.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="7.2" data-path="debt.html"><a href="debt.html#why-shouldnt-i-use-setwd"><i class="fa fa-check"></i><b>7.2</b> Why shouldn’t I use <code>setwd</code>?</a></li>
<li class="chapter" data-level="7.3" data-path="debt.html"><a href="debt.html#what-the-hell-are-factors"><i class="fa fa-check"></i><b>7.3</b> What the hell are factors?</a></li>
<li class="chapter" data-level="7.4" data-path="debt.html"><a href="debt.html#how-do-i-refer-to-various-arguments-in-a-pipeline"><i class="fa fa-check"></i><b>7.4</b> How do I refer to various arguments in a pipeline?</a></li>
<li class="chapter" data-level="7.5" data-path="debt.html"><a href="debt.html#i-thought-you-said-that-r-encouraged-functional-programming"><i class="fa fa-check"></i><b>7.5</b> I thought you said that R encouraged functional programming?</a></li>
<li class="chapter" data-level="7.6" data-path="debt.html"><a href="debt.html#how-does-r-give-the-appearance-of-immutable-data"><i class="fa fa-check"></i><b>7.6</b> How does R give the appearance of immutable data?</a></li>
<li class="chapter" data-level="7.7" data-path="debt.html"><a href="debt.html#what-else-should-i-worry-about"><i class="fa fa-check"></i><b>7.7</b> What else should I worry about?</a></li>
<li class="chapter" data-level="7.8" data-path="debt.html"><a href="debt.html#key-points-5"><i class="fa fa-check"></i><b>7.8</b> Key Points</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="testerror.html"><a href="testerror.html"><i class="fa fa-check"></i><b>8</b> Testing and Error Handling</a><ul>
<li class="chapter" data-level="8.1" data-path="testerror.html"><a href="testerror.html#learning-objectives-6"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="testerror.html"><a href="testerror.html#how-does-r-handle-errors"><i class="fa fa-check"></i><b>8.2</b> How does R handle errors?</a></li>
<li class="chapter" data-level="8.3" data-path="testerror.html"><a href="testerror.html#what-should-i-know-about-testing-in-general"><i class="fa fa-check"></i><b>8.3</b> What should I know about testing in general?</a></li>
<li class="chapter" data-level="8.4" data-path="testerror.html"><a href="testerror.html#how-should-i-organize-my-tests"><i class="fa fa-check"></i><b>8.4</b> How should I organize my tests?</a></li>
<li class="chapter" data-level="8.5" data-path="testerror.html"><a href="testerror.html#how-can-i-write-a-few-simple-tests"><i class="fa fa-check"></i><b>8.5</b> How can I write a few simple tests?</a></li>
<li class="chapter" data-level="8.6" data-path="testerror.html"><a href="testerror.html#how-can-i-check-data-transformation"><i class="fa fa-check"></i><b>8.6</b> How can I check data transformation?</a></li>
<li class="chapter" data-level="8.7" data-path="testerror.html"><a href="testerror.html#key-points-6"><i class="fa fa-check"></i><b>8.7</b> Key Points</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="advanced.html"><a href="advanced.html"><i class="fa fa-check"></i><b>9</b> Advanced Topics</a><ul>
<li class="chapter" data-level="9.1" data-path="advanced.html"><a href="advanced.html#learning-objectives-7"><i class="fa fa-check"></i><b>9.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="9.2" data-path="advanced.html"><a href="advanced.html#how-can-i-use-python-with-r"><i class="fa fa-check"></i><b>9.2</b> How can I use Python with R?</a></li>
<li class="chapter" data-level="9.3" data-path="advanced.html"><a href="advanced.html#how-does-object-oriented-programming-work-in-r"><i class="fa fa-check"></i><b>9.3</b> How does object-oriented programming work in R?</a></li>
<li class="chapter" data-level="9.4" data-path="advanced.html"><a href="advanced.html#how-can-i-write-web-applications-in-r"><i class="fa fa-check"></i><b>9.4</b> How can I write web applications in R?</a></li>
<li class="chapter" data-level="9.5" data-path="advanced.html"><a href="advanced.html#how-can-i-work-with-relational-databases-in-r"><i class="fa fa-check"></i><b>9.5</b> How can I work with relational databases in R?</a></li>
<li class="chapter" data-level="9.6" data-path="advanced.html"><a href="advanced.html#key-points-7"><i class="fa fa-check"></i><b>9.6</b> Key Points</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="license.html"><a href="license.html"><i class="fa fa-check"></i><b>A</b> License</a></li>
<li class="chapter" data-level="B" data-path="code-of-conduct.html"><a href="code-of-conduct.html"><i class="fa fa-check"></i><b>B</b> Code of Conduct</a><ul>
<li class="chapter" data-level="B.1" data-path="code-of-conduct.html"><a href="code-of-conduct.html#our-standards"><i class="fa fa-check"></i><b>B.1</b> Our Standards</a></li>
<li class="chapter" data-level="B.2" data-path="code-of-conduct.html"><a href="code-of-conduct.html#our-responsibilities"><i class="fa fa-check"></i><b>B.2</b> Our Responsibilities</a></li>
<li class="chapter" data-level="B.3" data-path="code-of-conduct.html"><a href="code-of-conduct.html#scope"><i class="fa fa-check"></i><b>B.3</b> Scope</a></li>
<li class="chapter" data-level="B.4" data-path="code-of-conduct.html"><a href="code-of-conduct.html#enforcement"><i class="fa fa-check"></i><b>B.4</b> Enforcement</a></li>
<li class="chapter" data-level="B.5" data-path="code-of-conduct.html"><a href="code-of-conduct.html#attribution"><i class="fa fa-check"></i><b>B.5</b> Attribution</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="citation.html"><a href="citation.html"><i class="fa fa-check"></i><b>C</b> Citation</a></li>
<li class="chapter" data-level="D" data-path="contributing.html"><a href="contributing.html"><i class="fa fa-check"></i><b>D</b> Contributing</a></li>
<li class="chapter" data-level="E" data-path="practice.html"><a href="practice.html"><i class="fa fa-check"></i><b>E</b> Practice Problems</a><ul>
<li class="chapter" data-level="E.1" data-path="practice.html"><a href="practice.html#do-i-need-even-more-practice"><i class="fa fa-check"></i><b>E.1</b> Do I need even more practice?</a></li>
<li class="chapter" data-level="E.2" data-path="practice.html"><a href="practice.html#please-may-i-create-some-charts"><i class="fa fa-check"></i><b>E.2</b> Please may I create some charts?</a></li>
</ul></li>
<li class="chapter" data-level="F" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i><b>F</b> Glossary</a></li>
<li class="chapter" data-level="G" data-path="keypoints.html"><a href="keypoints.html"><i class="fa fa-check"></i><b>G</b> Key Points</a><ul>
<li class="chapter" data-level="G.1" data-path="keypoints.html"><a href="keypoints.html#simple-beginnings"><i class="fa fa-check"></i><b>G.1</b> Simple Beginnings</a></li>
<li class="chapter" data-level="G.2" data-path="keypoints.html"><a href="keypoints.html#the-tidyverse"><i class="fa fa-check"></i><b>G.2</b> The Tidyverse</a></li>
<li class="chapter" data-level="G.3" data-path="keypoints.html"><a href="keypoints.html#creating-packages"><i class="fa fa-check"></i><b>G.3</b> Creating Packages</a></li>
<li class="chapter" data-level="G.4" data-path="keypoints.html"><a href="keypoints.html#non-standard-evaluation"><i class="fa fa-check"></i><b>G.4</b> Non-Standard Evaluation</a></li>
<li class="chapter" data-level="G.5" data-path="keypoints.html"><a href="keypoints.html#intellectual-debt"><i class="fa fa-check"></i><b>G.5</b> Intellectual Debt</a></li>
<li class="chapter" data-level="G.6" data-path="keypoints.html"><a href="keypoints.html#testing-and-error-handling"><i class="fa fa-check"></i><b>G.6</b> Testing and Error Handling</a></li>
<li class="chapter" data-level="G.7" data-path="keypoints.html"><a href="keypoints.html#advanced-topics"><i class="fa fa-check"></i><b>G.7</b> Advanced Topics</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Tidynomicon</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="testerror" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Testing and Error Handling</h1>
<p>Novices write code and pray that it works.
Experienced programmers know that prayer alone is not enough,
and take steps to protect what little sanity they have left.
This chapter looks at the tools R gives us for doing this.</p>
<div id="learning-objectives-6" class="section level2">
<h2><span class="header-section-number">8.1</span> Learning Objectives</h2>
<ul>
<li>Name and describe the three levels of error handling in R.</li>
<li>Handle an otherwise-fatal error in a function call in R.</li>
<li>Create unit tests in R.</li>
<li>Create unit tests for an R package.</li>
</ul>
</div>
<div id="how-does-r-handle-errors" class="section level2">
<h2><span class="header-section-number">8.2</span> How does R handle errors?</h2>
<p>Python programs handle errors
by <a href="glossary.html#raise-exception">raising</a> and <a href="glossary.html#catch-exception">catching</a> <a href="glossary.html#exception">exceptions</a>:</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb739-1" data-line-number="1">values <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb739-2" data-line-number="2"><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</a>
<a class="sourceLine" id="cb739-3" data-line-number="3">    <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb739-4" data-line-number="4">        reciprocal <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>values[i]</a>
<a class="sourceLine" id="cb739-5" data-line-number="5">        <span class="bu">print</span>(<span class="st">&quot;index </span><span class="sc">{}</span><span class="st"> value </span><span class="sc">{}</span><span class="st"> reciprocal </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(i, values[i], reciprocal))</a>
<a class="sourceLine" id="cb739-6" data-line-number="6">    <span class="cf">except</span> <span class="pp">ZeroDivisionError</span>:</a>
<a class="sourceLine" id="cb739-7" data-line-number="7">        <span class="bu">print</span>(<span class="st">&quot;index </span><span class="sc">{}</span><span class="st"> value </span><span class="sc">{}</span><span class="st"> ZeroDivisionError&quot;</span>.<span class="bu">format</span>(i, values[i]))</a>
<a class="sourceLine" id="cb739-8" data-line-number="8">    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</a>
<a class="sourceLine" id="cb739-9" data-line-number="9">        <span class="bu">print</span>(<span class="st">&quot;index</span><span class="sc">{}</span><span class="st"> some other Exception: </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>(i, e))</a></code></pre></div>
<pre><code>index 0 value -1 reciprocal -1.0
index 1 value 0 ZeroDivisionError
index 2 value 1 reciprocal 1.0
index3 some other Exception: list index out of range</code></pre>
<p>R draws on a different tradition.
We say that the operation <a href="glossary.html#signal-condition">signals</a> a <a href="glossary.html#condition">condition</a>
that some other piece of code then <a href="glossary.html#handle-condition">handles</a>.
These things are all simpler to do using the rlang library,
so we begin by loading that:</p>
<p>In order of increasing severity,
the three built-in kinds of conditions are <a href="glossary.html#message">messages</a>,
<a href="glossary.html#warning">warnings</a>,
and <a href="glossary.html#error">errors</a>.
(There are also interrupts,
which are generated by the user pressing Ctrl-C to stop an operation,
but we will ignore those for the sake of brevity.)
We can signal conditions of these kinds using the functions <code>message</code>, <code>warning</code>, and <code>stop</code>,
each of which takes an error message as a parameter:</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb741-1" data-line-number="1"><span class="kw">message</span>(<span class="st">&quot;This is a message.&quot;</span>)</a></code></pre></div>
<pre><code>This is a message.</code></pre>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb743-1" data-line-number="1"><span class="kw">warning</span>(<span class="st">&quot;This is a warning.</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>Warning: This is a warning.</code></pre>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb745-1" data-line-number="1"><span class="kw">stop</span>(<span class="st">&quot;This is an error.&quot;</span>)</a></code></pre></div>
<pre><code>Error in eval(expr, envir, enclos): This is an error.</code></pre>
<p>Note that we have to supply our own line ending for warnings
but not for the other two cases.
Note also that there are very few situations in which a warning is appropriate:
if something has truly gone wrong then we should stop,
but otherwise we should not distract users from more pressing concerns.</p>
<p>The bluntest of instruments for handling errors is to ignore them.
If a statement is wrapped in the function <code>try</code>
then errors that occur in it are still reported,
but execution continues.
Compare this:</p>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb747-1" data-line-number="1">attemptWithoutTry &lt;-<span class="st"> </span><span class="cf">function</span>(left, right){</a>
<a class="sourceLine" id="cb747-2" data-line-number="2">  temp &lt;-<span class="st"> </span>left <span class="op">+</span><span class="st"> </span>right</a>
<a class="sourceLine" id="cb747-3" data-line-number="3">  <span class="st">&quot;result&quot;</span> <span class="co"># returned</span></a>
<a class="sourceLine" id="cb747-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb747-5" data-line-number="5">result &lt;-<span class="st"> </span><span class="kw">attemptWithoutTry</span>(<span class="dv">1</span>, <span class="st">&quot;two&quot;</span>)</a></code></pre></div>
<pre><code>Error in left + right: non-numeric argument to binary operator</code></pre>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb749-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;result is&quot;</span>, result)</a></code></pre></div>
<pre><code>Error in cat(&quot;result is&quot;, result): object &#39;result&#39; not found</code></pre>
<p>with this:</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb751-1" data-line-number="1">attemptUsingTry &lt;-<span class="st"> </span><span class="cf">function</span>(left, right){</a>
<a class="sourceLine" id="cb751-2" data-line-number="2">  temp &lt;-<span class="st"> </span><span class="kw">try</span>(left <span class="op">+</span><span class="st"> </span>right)</a>
<a class="sourceLine" id="cb751-3" data-line-number="3">  <span class="st">&quot;value returned&quot;</span> <span class="co"># returned</span></a>
<a class="sourceLine" id="cb751-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb751-5" data-line-number="5">result &lt;-<span class="st"> </span><span class="kw">attemptUsingTry</span>(<span class="dv">1</span>, <span class="st">&quot;two&quot;</span>)</a></code></pre></div>
<pre><code>Error in left + right : non-numeric argument to binary operator</code></pre>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb753-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;result is&quot;</span>, result)</a></code></pre></div>
<pre><code>result is value returned</code></pre>
<p>We can suppress error messages from <code>try</code> by setting <code>silent</code> to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb755-1" data-line-number="1">attemptUsingTryQuietly &lt;-<span class="st"> </span><span class="cf">function</span>(left, right){</a>
<a class="sourceLine" id="cb755-2" data-line-number="2">  temp &lt;-<span class="st"> </span><span class="kw">try</span>(left <span class="op">+</span><span class="st"> </span>right, <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb755-3" data-line-number="3">  <span class="st">&quot;result&quot;</span> <span class="co"># returned</span></a>
<a class="sourceLine" id="cb755-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb755-5" data-line-number="5">result &lt;-<span class="st"> </span><span class="kw">attemptUsingTryQuietly</span>(<span class="dv">1</span>, <span class="st">&quot;two&quot;</span>)</a>
<a class="sourceLine" id="cb755-6" data-line-number="6"><span class="kw">cat</span>(<span class="st">&quot;result is&quot;</span>, result)</a></code></pre></div>
<pre><code>result is result</code></pre>
<p>Do not do this,
lest you one day find yourself lost in a silent hellscape.</p>
<p>Should you more sensibly wish to handle conditions rather than ignore them,
you may invoke <code>tryCatch</code>.
We begin by raising an error explicitly:</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb757-1" data-line-number="1"><span class="kw">tryCatch</span>(</a>
<a class="sourceLine" id="cb757-2" data-line-number="2">  <span class="kw">stop</span>(<span class="st">&quot;our message&quot;</span>),</a>
<a class="sourceLine" id="cb757-3" data-line-number="3">  <span class="dt">error =</span> <span class="cf">function</span>(cnd) <span class="kw">print</span>(<span class="kw">glue</span>(<span class="st">&quot;error object is {cnd}&quot;</span>))</a>
<a class="sourceLine" id="cb757-4" data-line-number="4">)</a></code></pre></div>
<pre><code>error object is Error in doTryCatch(return(expr), name, parentenv, handler): our message</code></pre>
<p>We can now run a function that would otherwise blow up:</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb759-1" data-line-number="1"><span class="kw">tryCatch</span>(</a>
<a class="sourceLine" id="cb759-2" data-line-number="2">  <span class="kw">attemptWithoutTry</span>(<span class="dv">1</span>, <span class="st">&quot;two&quot;</span>),</a>
<a class="sourceLine" id="cb759-3" data-line-number="3">  <span class="dt">error =</span> <span class="cf">function</span>(cnd) <span class="kw">print</span>(<span class="kw">glue</span>(<span class="st">&quot;error object is {cnd}&quot;</span>))</a>
<a class="sourceLine" id="cb759-4" data-line-number="4">)</a></code></pre></div>
<pre><code>error object is Error in left + right: non-numeric argument to binary operator</code></pre>
<p>We can also handle non-fatal errors using <code>withCallingHandlers</code>,
and define new types of conditions,
but this is done less often in day-to-day R code than in Python:
see <em><a href="http://adv-r.had.co.nz/">Advanced R</a></em> or <a href="https://www.onceupondata.com/2018/09/28/handling-r-errors/">this tutorial</a> for details.</p>
</div>
<div id="what-should-i-know-about-testing-in-general" class="section level2">
<h2><span class="header-section-number">8.3</span> What should I know about testing in general?</h2>
<p>In keeping with common programming practice,
we have left testing until the last possible moment.
The standard testing library for R is <a href="https://github.com/r-lib/testthat">testthat</a>,
which shares many features with Python’s <a href="https://docs.python.org/3/library/unittest.html">unittest</a>
and other <a href="glossary.html#unit-test">unit testing</a> libraries:</p>
<ol style="list-style-type: decimal">
<li>Each test consists of a single function that tests a single property or behavior of the system.</li>
<li>Tests are collected into files with prescribed names that can be found by a <a href="glossary.html#test-runner">test runner</a>.</li>
<li>Shared <a href="glossary.html#testing-setup">setup</a> and <a href="glossary.html#testing-teardown">teardown</a> steps are put in functions of their own.</li>
</ol>
<p>Let’s load it and write our first test:</p>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb761-1" data-line-number="1"><span class="kw">library</span>(testthat)</a></code></pre></div>
<pre><code>
Attaching package: &#39;testthat&#39;</code></pre>
<pre><code>The following objects are masked from &#39;package:rlang&#39;:

    is_false, is_null, is_true</code></pre>
<pre><code>The following object is masked from &#39;package:dplyr&#39;:

    matches</code></pre>
<pre><code>The following object is masked from &#39;package:purrr&#39;:

    is_null</code></pre>
<pre><code>The following object is masked from &#39;package:tidyr&#39;:

    matches</code></pre>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb767-1" data-line-number="1"><span class="kw">test_that</span>(<span class="st">&quot;Zero equals itself&quot;</span>, {<span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="dv">0</span>)})</a></code></pre></div>
<p>As is conventional with unit testing libraries,
no news is good news:
if a test passes,
it doesn’t produce output because it doesn’t need our attention.
Let’s try something that ought to fail:</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb768-1" data-line-number="1"><span class="kw">test_that</span>(<span class="st">&quot;Zero equals one&quot;</span>, {<span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="dv">1</span>)})</a></code></pre></div>
<pre><code>Error: Test failed: &#39;Zero equals one&#39;
* &lt;text&gt;:1: 0 not equal to 1.
1/1 mismatches
[1] 0 - 1 == -1</code></pre>
<p>Good:
we can draw some comfort from the fact that Those Beyond have not yet changed the fundamental rules of arithmetic.
But what are the curly braces around <code>expect_equal</code> for?
The answer is that they create a <a href="glossary.html#code-block">code block</a> for <code>test_that</code> to run.
We can run <code>expect_equal</code> on its own:</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb770-1" data-line-number="1"><span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="dv">1</span>)</a></code></pre></div>
<pre><code>Error: 0 not equal to 1.
1/1 mismatches
[1] 0 - 1 == -1</code></pre>
<p>but that doesn’t produce a summary of how many tests passed or failed.
Passing a block of code to <code>test_that</code> also allows us to check several things in one test:</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb772-1" data-line-number="1"><span class="kw">test_that</span>(<span class="st">&quot;Testing two things&quot;</span>, {</a>
<a class="sourceLine" id="cb772-2" data-line-number="2">  <span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb772-3" data-line-number="3">  <span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb772-4" data-line-number="4">})</a></code></pre></div>
<pre><code>Error: Test failed: &#39;Testing two things&#39;
* &lt;text&gt;:3: 0 not equal to 1.
1/1 mismatches
[1] 0 - 1 == -1</code></pre>
<p>A block of code is <em>not</em> the same thing as an <a href="glossary.html#anonymous-function">anonymous function</a>,
which is why running this block of code does nothing—the “test” defines a function
but doesn’t actually call it:</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb774-1" data-line-number="1"><span class="kw">test_that</span>(<span class="st">&quot;Using an anonymous function&quot;</span>, <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb774-2" data-line-number="2">  <span class="kw">print</span>(<span class="st">&quot;In our anonymous function&quot;</span>)</a>
<a class="sourceLine" id="cb774-3" data-line-number="3">  <span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb774-4" data-line-number="4">})</a></code></pre></div>
</div>
<div id="how-should-i-organize-my-tests" class="section level2">
<h2><span class="header-section-number">8.4</span> How should I organize my tests?</h2>
<p>Running blocks of tests by hand is a bad practice.
Instead,
we should put related tests in files
and then put those files in a directory called <code>tests/testthat</code>.
We can then run some or all of those tests with a single command.</p>
<p>To start,
let’s create <code>tests/testthat/test_example.R</code>:</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb775-1" data-line-number="1"><span class="kw">library</span>(testthat)</a>
<a class="sourceLine" id="cb775-2" data-line-number="2"><span class="kw">context</span>(<span class="st">&quot;Demonstrating the testing library&quot;</span>)</a>
<a class="sourceLine" id="cb775-3" data-line-number="3"></a>
<a class="sourceLine" id="cb775-4" data-line-number="4"><span class="kw">test_that</span>(<span class="st">&quot;Testing a number with itself&quot;</span>, {</a>
<a class="sourceLine" id="cb775-5" data-line-number="5">  <span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb775-6" data-line-number="6">  <span class="kw">expect_equal</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb775-7" data-line-number="7">  <span class="kw">expect_equal</span>(<span class="ot">Inf</span>, <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb775-8" data-line-number="8">})</a>
<a class="sourceLine" id="cb775-9" data-line-number="9"></a>
<a class="sourceLine" id="cb775-10" data-line-number="10"><span class="kw">test_that</span>(<span class="st">&quot;Testing different numbers&quot;</span>, {</a>
<a class="sourceLine" id="cb775-11" data-line-number="11">  <span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb775-12" data-line-number="12">})</a>
<a class="sourceLine" id="cb775-13" data-line-number="13"></a>
<a class="sourceLine" id="cb775-14" data-line-number="14"><span class="kw">test_that</span>(<span class="st">&quot;Testing with a tolerance&quot;</span>, {</a>
<a class="sourceLine" id="cb775-15" data-line-number="15">  <span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="dt">tolerance =</span> <span class="fl">0.05</span>, <span class="dt">scale =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb775-16" data-line-number="16">  <span class="kw">expect_equal</span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="dt">tolerance =</span> <span class="fl">0.005</span>, <span class="dt">scale =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb775-17" data-line-number="17">})</a></code></pre></div>
<p>The first line loads the testthat package,
which gives us our tools.
The call to <code>context</code> on the second line gives this set of tests a name for reporting purposes.
After that,
we add as many calls to <code>test_that</code> as we want,
each with a name and a block of code.
We can now run this file from within RStudio:</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb776-1" data-line-number="1"><span class="kw">test_dir</span>(<span class="st">&quot;tests/testthat&quot;</span>)</a></code></pre></div>
<pre><code>✔ |  OK F W S | Context

⠏ |   0       | Skipping rows correctly
⠹ |   0 3     | Skipping rows correctly
✖ |   0 5     | Skipping rows correctly [0.1 s]
────────────────────────────────────────────────────────────────────────────────
test_determine_skip_rows_a.R:9: failure: The right row is found when there are header rows
`result` not equal to 2.
Lengths differ: 0 is not 1

test_determine_skip_rows_a.R:14: failure: The right row is found when there are header rows and blank lines
`result` not equal to 3.
Lengths differ: 0 is not 1

test_determine_skip_rows_a.R:19: failure: The right row is found when there are no header rows to discard
`result` not equal to 0.
Lengths differ: 0 is not 1

test_determine_skip_rows_a.R:23: failure: No row is found when &#39;iso3&#39; isn&#39;t present
`determine_skip_rows(&quot;a1,a2\nb1,b1\n&quot;)` did not throw an error.

test_determine_skip_rows_a.R:28: failure: No row is found when &#39;iso3&#39; is in the wrong place
`determine_skip_rows(&quot;stuff,iso3\n&quot;)` did not throw an error.
────────────────────────────────────────────────────────────────────────────────

⠏ |   0       | Skipping rows correctly
✔ |   5       | Skipping rows correctly

⠏ |   0       | Demonstrating the testing library
✖ |   4 2     | Demonstrating the testing library
────────────────────────────────────────────────────────────────────────────────
test_example.R:11: failure: Testing different numbers
0 not equal to 1.
1/1 mismatches
[1] 0 - 1 == -1

test_example.R:16: failure: Testing with a tolerance
0 not equal to 0.01.
1/1 mismatches
[1] 0 - 0.01 == -0.01
────────────────────────────────────────────────────────────────────────────────

⠏ |   0       | Finding empty rows
✖ |   1 2     | Finding empty rows
────────────────────────────────────────────────────────────────────────────────
test_find_empty_a.R:9: failure: A single non-empty row is not mistakenly detected
`result` not equal to NULL.
Types not compatible: integer is not NULL

test_find_empty_a.R:14: failure: Half-empty rows are not mistakenly detected
`result` not equal to NULL.
Types not compatible: integer is not NULL
────────────────────────────────────────────────────────────────────────────────

⠏ |   0       | Finding empty rows
✔ |   3       | Finding empty rows

⠏ |   0       | Testing properties of tibbles
✔ |   1   1   | Testing properties of tibbles
────────────────────────────────────────────────────────────────────────────────
test_tibble.R:6: warning: Tibble columns are given the name &#39;value&#39;
`as.tibble()` is deprecated as of tibble 2.0.0.
Please use `as_tibble()` instead.
The signature and semantics have changed, see `?as_tibble`.
This warning is displayed once every 8 hours.
Call `lifecycle::last_warnings()` to see where this warning was generated.
────────────────────────────────────────────────────────────────────────────────

══ Results ═════════════════════════════════════════════════════════════════════
Duration: 0.3 s

OK:       14
Failed:   9
Warnings: 1
Skipped:  0

Frustration is a natural part of programming :)</code></pre>
<p>Care is needed when interpreting these results.
There are four <code>test_that</code> calls,
but eight actual checks,
and the number of successes and failures is counted by recording the latter,
not the former.</p>
<p>What then is the purpose of <code>test_that</code>?
Why not just use <code>expect_equal</code> and its kin,
such as <code>expect_true</code>, <code>expect_false</code>, <code>expect_length</code>, and so on?
The answer is that it allows us to do one operation and then check several things afterward.
Let’s create another file called <code>tests/testthat/test_tibble.R</code>:</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb778-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb778-2" data-line-number="2"><span class="kw">library</span>(testthat)</a>
<a class="sourceLine" id="cb778-3" data-line-number="3"><span class="kw">context</span>(<span class="st">&quot;Testing properties of tibbles&quot;</span>)</a>
<a class="sourceLine" id="cb778-4" data-line-number="4"></a>
<a class="sourceLine" id="cb778-5" data-line-number="5"><span class="kw">test_that</span>(<span class="st">&quot;Tibble columns are given the name &#39;value&#39;&quot;</span>, {</a>
<a class="sourceLine" id="cb778-6" data-line-number="6">  t &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.tibble</span>()</a>
<a class="sourceLine" id="cb778-7" data-line-number="7">  <span class="kw">expect_equal</span>(<span class="kw">names</span>(t), <span class="st">&quot;value&quot;</span>)</a>
<a class="sourceLine" id="cb778-8" data-line-number="8">})</a></code></pre></div>
<p>(We don’t actually have to call our test files <code>test_something.R</code>,
but <code>test_dir</code> and the rest of R’s testing infrastructure expect us to.
Similarly,
we don’t have to put them in a <code>tests</code> directory,
but gibbering incoherence will ensue if we do not.)
Now let’s run all of our tests:</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb779-1" data-line-number="1"><span class="kw">test_dir</span>(<span class="st">&quot;tests/testthat&quot;</span>)</a></code></pre></div>
<pre><code>✔ |  OK F W S | Context

⠏ |   0       | Skipping rows correctly
✖ |   0 5     | Skipping rows correctly
────────────────────────────────────────────────────────────────────────────────
test_determine_skip_rows_a.R:9: failure: The right row is found when there are header rows
`result` not equal to 2.
Lengths differ: 0 is not 1

test_determine_skip_rows_a.R:14: failure: The right row is found when there are header rows and blank lines
`result` not equal to 3.
Lengths differ: 0 is not 1

test_determine_skip_rows_a.R:19: failure: The right row is found when there are no header rows to discard
`result` not equal to 0.
Lengths differ: 0 is not 1

test_determine_skip_rows_a.R:23: failure: No row is found when &#39;iso3&#39; isn&#39;t present
`determine_skip_rows(&quot;a1,a2\nb1,b1\n&quot;)` did not throw an error.

test_determine_skip_rows_a.R:28: failure: No row is found when &#39;iso3&#39; is in the wrong place
`determine_skip_rows(&quot;stuff,iso3\n&quot;)` did not throw an error.
────────────────────────────────────────────────────────────────────────────────

⠏ |   0       | Skipping rows correctly
✔ |   5       | Skipping rows correctly

⠏ |   0       | Demonstrating the testing library
✖ |   4 2     | Demonstrating the testing library
────────────────────────────────────────────────────────────────────────────────
test_example.R:11: failure: Testing different numbers
0 not equal to 1.
1/1 mismatches
[1] 0 - 1 == -1

test_example.R:16: failure: Testing with a tolerance
0 not equal to 0.01.
1/1 mismatches
[1] 0 - 0.01 == -0.01
────────────────────────────────────────────────────────────────────────────────

⠏ |   0       | Finding empty rows
✖ |   1 2     | Finding empty rows
────────────────────────────────────────────────────────────────────────────────
test_find_empty_a.R:9: failure: A single non-empty row is not mistakenly detected
`result` not equal to NULL.
Types not compatible: integer is not NULL

test_find_empty_a.R:14: failure: Half-empty rows are not mistakenly detected
`result` not equal to NULL.
Types not compatible: integer is not NULL
────────────────────────────────────────────────────────────────────────────────

⠏ |   0       | Finding empty rows
✔ |   3       | Finding empty rows

⠏ |   0       | Testing properties of tibbles
✔ |   1       | Testing properties of tibbles

══ Results ═════════════════════════════════════════════════════════════════════
Duration: 0.2 s

OK:       14
Failed:   9
Warnings: 0
Skipped:  0</code></pre>
<p>That’s rather a lot of output.
Happily,
we can provide a <code>filter</code> argument to <code>test_dir</code>:</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb781-1" data-line-number="1"><span class="kw">test_dir</span>(<span class="st">&quot;tests/testthat&quot;</span>, <span class="dt">filter =</span> <span class="st">&quot;test_tibble.R&quot;</span>)</a></code></pre></div>
<pre><code>Error in test_files(paths, reporter = reporter, env = env, stop_on_failure = stop_on_failure, : No matching test file in dir</code></pre>
<p>Ah.
It turns out that <code>filter</code> is applied to filenames <em>after</em> the leading <code>test_</code> and the trailing <code>.R</code> have been removed.
Let’s try again:</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb783-1" data-line-number="1"><span class="kw">test_dir</span>(<span class="st">&quot;tests/testthat&quot;</span>, <span class="dt">filter =</span> <span class="st">&quot;tibble&quot;</span>)</a></code></pre></div>
<pre><code>✔ |  OK F W S | Context

⠏ |   0       | Testing properties of tibbles
✔ |   1       | Testing properties of tibbles

══ Results ═════════════════════════════════════════════════════════════════════
OK:       1
Failed:   0
Warnings: 0
Skipped:  0</code></pre>
<p>That’s better,
and it illustrates our earlier point about the importance of following conventions.</p>
</div>
<div id="how-can-i-write-a-few-simple-tests" class="section level2">
<h2><span class="header-section-number">8.5</span> How can I write a few simple tests?</h2>
<p>To give ourselves something to test,
let’s create a file called <code>scripts/find_empty_01.R</code>
containing a single function <code>find_empty_rows</code> to identy all the empty rows in a CSV file.
Our first implementation is:</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb785-1" data-line-number="1">find_empty_rows &lt;-<span class="st"> </span><span class="cf">function</span>(source) {</a>
<a class="sourceLine" id="cb785-2" data-line-number="2">  data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(source)</a>
<a class="sourceLine" id="cb785-3" data-line-number="3">  empty &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb785-4" data-line-number="4"><span class="st">    </span><span class="kw">pmap</span>(<span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb785-5" data-line-number="5">      args &lt;-<span class="st"> </span><span class="kw">list</span>(...)</a>
<a class="sourceLine" id="cb785-6" data-line-number="6">      <span class="kw">all</span>(<span class="kw">is.na</span>(args) <span class="op">|</span><span class="st"> </span>(args <span class="op">==</span><span class="st"> &quot;&quot;</span>))</a>
<a class="sourceLine" id="cb785-7" data-line-number="7">    })</a>
<a class="sourceLine" id="cb785-8" data-line-number="8">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb785-9" data-line-number="9"><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb785-10" data-line-number="10"><span class="st">    </span><span class="kw">filter</span>(<span class="kw">as.logical</span>(empty)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb785-11" data-line-number="11"><span class="st">    </span><span class="kw">pull</span>(id)</a>
<a class="sourceLine" id="cb785-12" data-line-number="12">}</a></code></pre></div>
<p>This is complex enough to merit line-by-line exegesis:</p>
<ol style="list-style-type: decimal">
<li>Define the function with one argument <code>source</code>, whence we shall read.</li>
<li>Read tabular data from that source and assign the resulting tibble to <code>data</code>.</li>
<li>Begin a pipeline that will assign something to the variable <code>empty</code>.
<ol style="list-style-type: decimal">
<li>Use <code>pmap</code> to map a function across each row of the tibble.
Since we don’t know how many columns are in each row,
we use <code>...</code> to take any number of arguments.</li>
<li>Convert the variable number of arguments to a list.</li>
<li>Check to see if all of those arguments are either <code>NA</code> or the empty string.</li>
<li>Close the mapped function’s definition.</li>
</ol></li>
<li>Start another pipeline.
Its result isn’t assigned to a variable,
so whatever it produces will be the value returned by <code>find_empty_rows</code>.
<ol style="list-style-type: decimal">
<li>Construct a tibble that contains only the row numbers of the original table in a column called <code>id</code>.</li>
<li>Filter those row numbers to keep only those corresponding to rows that were entirely empty.
The <code>as.logical</code> call inside <code>filter</code> is needed because the value returned by <code>pmap</code>
(which we stored in <code>empty</code>)
is a list, not a logical vector.</li>
<li>Use <code>pull</code> to get the one column we want from the filtered tibble as a vector.</li>
</ol></li>
</ol>
<p>There is a lot going on here,
particularly if you are new to R (as I am at the time of writing)
and needed help to figure out that <code>pmap</code> is the function this problem wants.
But now that we have it,
we can do this:</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb786-1" data-line-number="1"><span class="kw">source</span>(<span class="st">&quot;scripts/find_empty_01.R&quot;</span>)</a>
<a class="sourceLine" id="cb786-2" data-line-number="2"><span class="kw">find_empty_rows</span>(<span class="st">&quot;a,b</span><span class="ch">\n</span><span class="st">1,2</span><span class="ch">\n</span><span class="st">,</span><span class="ch">\n</span><span class="st">5,6&quot;</span>)</a></code></pre></div>
<p>The <code>source</code> function reads R code from the given source.
Using this inside an R Markdown file is usually a bad idea,
since the generated HTML or PDF won’t show readers what code we loaded and ran.
On the other hand,
if we are creating command-line tools for use on clusters or in other batch processing modes,
and are careful to display the code in a nearby block,
the stain on our soul is excusable.</p>
<p>The more interesting part of this example is the call to <code>find_empty_rows</code>.
Instead of giving it the name of a file,
we have given it the text of the CSV we want parsed.
This string is passed to <code>read_csv</code>,
which (according to documentation that only took us 15 minutes to realize we had already seen)
interprets its first argument as a filename <em>or</em>
as the actual text to be parsed if it contains a newline character.
This allows us to write put the <a href="glossary.html#test-fixture">test fixture</a>
right there in the code as a literal string,
which experience shows is to understand and maintain
than having test data in separate files.</p>
<p>Our function seems to work,
but we can make it more pipelinesque:</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb787-1" data-line-number="1">find_empty_rows &lt;-<span class="st"> </span><span class="cf">function</span>(source) {</a>
<a class="sourceLine" id="cb787-2" data-line-number="2">  <span class="kw">read_csv</span>(source) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb787-3" data-line-number="3"><span class="st">    </span><span class="kw">pmap_lgl</span>(<span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb787-4" data-line-number="4">      args &lt;-<span class="st"> </span><span class="kw">list</span>(...)</a>
<a class="sourceLine" id="cb787-5" data-line-number="5">      <span class="kw">all</span>(<span class="kw">is.na</span>(args) <span class="op">|</span><span class="st"> </span>(args <span class="op">==</span><span class="st"> &quot;&quot;</span>))</a>
<a class="sourceLine" id="cb787-6" data-line-number="6">    }) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb787-7" data-line-number="7"><span class="st">    </span><span class="kw">tibble</span>(<span class="dt">empty =</span> .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb787-8" data-line-number="8"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb787-9" data-line-number="9"><span class="st">    </span><span class="kw">filter</span>(empty) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb787-10" data-line-number="10"><span class="st">    </span><span class="kw">pull</span>(id)</a>
<a class="sourceLine" id="cb787-11" data-line-number="11">}</a></code></pre></div>
<p>Going line by line once again:</p>
<ol style="list-style-type: decimal">
<li>Define a function with one argument called <code>source</code>, from which we shall once again read.</li>
<li>Read from that source to fill the pipeline.</li>
<li>Map our test for emptiness across each row, returning a logical vector as a result.
(<code>pmap_lgl</code> is a derivative of <code>pmap</code> that always casts its result to logical.
Similar functions like <code>pmap_dbl</code> return vectors of other types;
and many other tidyverse functions also have strongly-typed variants.)</li>
<li>Turn that logical vector into a single-column tibble,
giving that column the name “empty”.
We explain the use of <code>.</code> below.</li>
<li>Add a second column with row numbers.</li>
<li>Discard rows that aren’t empty.</li>
<li>Return a vector of the remaining row IDs.</li>
</ol>
<blockquote>
<p><strong>Wat?</strong></p>
<p>Buried in the middle of the pipe shown above is the expression:</p>
<p><code>tibble(empty = .)</code></p>
<p>Quoting from <em><a href="http://adv-r.had.co.nz/">Advanced R</a></em>,
“The function arguments look a little quirky
but allow you to refer to <code>.</code> for one argument functions,
<code>.x</code> and <code>.y.</code> for two argument functions,
and <code>..1</code>, <code>..2</code>, <code>..3</code>, etc, for functions with an arbitrary number of arguments.”
In other words, <code>.</code> in tidyverse functions usually means “whatever is on the left side of the <code>%&gt;%</code> operator”,
i.e., whatever would normally be passed as the function’s first argument.
Without this,
we have no easy way to give the sole column of our newly-constructed tibble a name.</p>
</blockquote>
<p>Here’s our first batch of tests:</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb788-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb788-2" data-line-number="2"><span class="kw">library</span>(testthat)</a>
<a class="sourceLine" id="cb788-3" data-line-number="3"><span class="kw">context</span>(<span class="st">&quot;Finding empty rows&quot;</span>)</a>
<a class="sourceLine" id="cb788-4" data-line-number="4"></a>
<a class="sourceLine" id="cb788-5" data-line-number="5"><span class="kw">source</span>(<span class="st">&quot;../../scripts/find_empty_02.R&quot;</span>)</a>
<a class="sourceLine" id="cb788-6" data-line-number="6"></a>
<a class="sourceLine" id="cb788-7" data-line-number="7"><span class="kw">test_that</span>(<span class="st">&quot;A single non-empty row is not mistakenly detected&quot;</span>, {</a>
<a class="sourceLine" id="cb788-8" data-line-number="8">  result &lt;-<span class="st"> </span><span class="kw">find_empty_rows</span>(<span class="st">&quot;a</span><span class="ch">\n</span><span class="st">1&quot;</span>)</a>
<a class="sourceLine" id="cb788-9" data-line-number="9">  <span class="kw">expect_equal</span>(result, <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb788-10" data-line-number="10">})</a>
<a class="sourceLine" id="cb788-11" data-line-number="11"></a>
<a class="sourceLine" id="cb788-12" data-line-number="12"><span class="kw">test_that</span>(<span class="st">&quot;Half-empty rows are not mistakenly detected&quot;</span>, {</a>
<a class="sourceLine" id="cb788-13" data-line-number="13">  result &lt;-<span class="st"> </span><span class="kw">find_empty_rows</span>(<span class="st">&quot;a,b</span><span class="ch">\n</span><span class="st">,2&quot;</span>)</a>
<a class="sourceLine" id="cb788-14" data-line-number="14">  <span class="kw">expect_equal</span>(result, <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb788-15" data-line-number="15">})</a>
<a class="sourceLine" id="cb788-16" data-line-number="16"></a>
<a class="sourceLine" id="cb788-17" data-line-number="17"><span class="kw">test_that</span>(<span class="st">&quot;An empty row in the middle is found&quot;</span>, {</a>
<a class="sourceLine" id="cb788-18" data-line-number="18">  result &lt;-<span class="st"> </span><span class="kw">find_empty_rows</span>(<span class="st">&quot;a,b</span><span class="ch">\n</span><span class="st">1,2</span><span class="ch">\n</span><span class="st">,</span><span class="ch">\n</span><span class="st">5,6&quot;</span>)</a>
<a class="sourceLine" id="cb788-19" data-line-number="19">  <span class="kw">expect_equal</span>(result, <span class="kw">c</span>(2L))</a>
<a class="sourceLine" id="cb788-20" data-line-number="20">})</a></code></pre></div>
<p>And here’s what happens when we run this file with <code>test_dir</code>:</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb789-1" data-line-number="1"><span class="kw">test_dir</span>(<span class="st">&quot;tests/testthat&quot;</span>, <span class="st">&quot;find_empty_a&quot;</span>)</a></code></pre></div>
<pre><code>✔ |  OK F W S | Context

⠏ |   0       | Finding empty rows
✖ |   1 2     | Finding empty rows
────────────────────────────────────────────────────────────────────────────────
test_find_empty_a.R:9: failure: A single non-empty row is not mistakenly detected
`result` not equal to NULL.
Types not compatible: integer is not NULL

test_find_empty_a.R:14: failure: Half-empty rows are not mistakenly detected
`result` not equal to NULL.
Types not compatible: integer is not NULL
────────────────────────────────────────────────────────────────────────────────

══ Results ═════════════════════════════════════════════════════════════════════
OK:       1
Failed:   2
Warnings: 0
Skipped:  0</code></pre>
<p>This is perplexing:
we expected that if there were no empty rows,
our function would return <code>NULL</code>.
Let’s look more closely:</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb791-1" data-line-number="1"><span class="kw">find_empty_rows</span>(<span class="st">&quot;a</span><span class="ch">\n</span><span class="st">1&quot;</span>)</a></code></pre></div>
<pre><code>integer(0)</code></pre>
<p>Ah:
our function is returning an integer vector of zero length rather than <code>NULL</code>.
Let’s have a closer look at the properties of this strange beast:</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb793-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">glue</span>(<span class="st">&quot;integer(0) equal to NULL? {is.null(integer(0))}&quot;</span>))</a></code></pre></div>
<pre><code>integer(0) equal to NULL? FALSE</code></pre>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb795-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">glue</span>(<span class="st">&quot;any(logical(0))? {any(logical(0))}&quot;</span>))</a></code></pre></div>
<pre><code>any(logical(0))? FALSE</code></pre>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb797-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">glue</span>(<span class="st">&quot;all(logical(0))? {all(logical(0))}&quot;</span>))</a></code></pre></div>
<pre><code>all(logical(0))? TRUE</code></pre>
<p>All right.
If we compare <code>c(1L, 2L)</code> to <code>NULL</code>, we expect <code>c(FALSE, FALSE)</code>,
so it’s reasonable to get a zero-length logical vector as a result
when we compare <code>NULL</code> to an integer vector with no elements.
The fact that <code>any</code> of an empty logical vector is <code>FALSE</code> isn’t really surprising either—none of the elements are <code>TRUE</code>,
so it would be hard to say that any of them are.
<code>all</code> of an empty vector being <code>TRUE</code> is unexpected, though.
The reasoning is apparently that none of the (nonexistent) elements are <code>FALSE</code>,
but honestly,
at this point we are veering dangerously close to <a href="https://www.destroyallsoftware.com/talks/wat">JavaScript Logic</a>,
so we will accept this result for what it is and move on.</p>
<p>So what <em>should</em> our function return when there aren’t any empty rows: <code>NULL</code> or <code>integer(0)</code>?
After a bit of thought,
we decide on the latter,
which means it’s the tests that we need to rewrite,
not the code:</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb799-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb799-2" data-line-number="2"><span class="kw">library</span>(testthat)</a>
<a class="sourceLine" id="cb799-3" data-line-number="3"><span class="kw">context</span>(<span class="st">&quot;Finding empty rows&quot;</span>)</a>
<a class="sourceLine" id="cb799-4" data-line-number="4"></a>
<a class="sourceLine" id="cb799-5" data-line-number="5"><span class="kw">source</span>(<span class="st">&quot;../../scripts/find_empty_02.R&quot;</span>)</a>
<a class="sourceLine" id="cb799-6" data-line-number="6"></a>
<a class="sourceLine" id="cb799-7" data-line-number="7"><span class="kw">test_that</span>(<span class="st">&quot;A single non-empty row is not mistakenly detected&quot;</span>, {</a>
<a class="sourceLine" id="cb799-8" data-line-number="8">  result &lt;-<span class="st"> </span><span class="kw">find_empty_rows</span>(<span class="st">&quot;a</span><span class="ch">\n</span><span class="st">1&quot;</span>)</a>
<a class="sourceLine" id="cb799-9" data-line-number="9">  <span class="kw">expect_equal</span>(result, <span class="kw">integer</span>(<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb799-10" data-line-number="10">})</a>
<a class="sourceLine" id="cb799-11" data-line-number="11"></a>
<a class="sourceLine" id="cb799-12" data-line-number="12"><span class="kw">test_that</span>(<span class="st">&quot;Half-empty rows are not mistakenly detected&quot;</span>, {</a>
<a class="sourceLine" id="cb799-13" data-line-number="13">  result &lt;-<span class="st"> </span><span class="kw">find_empty_rows</span>(<span class="st">&quot;a,b</span><span class="ch">\n</span><span class="st">,2&quot;</span>)</a>
<a class="sourceLine" id="cb799-14" data-line-number="14">  <span class="kw">expect_equal</span>(result, <span class="kw">integer</span>(<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb799-15" data-line-number="15">})</a>
<a class="sourceLine" id="cb799-16" data-line-number="16"></a>
<a class="sourceLine" id="cb799-17" data-line-number="17"><span class="kw">test_that</span>(<span class="st">&quot;An empty row in the middle is found&quot;</span>, {</a>
<a class="sourceLine" id="cb799-18" data-line-number="18">  result &lt;-<span class="st"> </span><span class="kw">find_empty_rows</span>(<span class="st">&quot;a,b</span><span class="ch">\n</span><span class="st">1,2</span><span class="ch">\n</span><span class="st">,</span><span class="ch">\n</span><span class="st">5,6&quot;</span>)</a>
<a class="sourceLine" id="cb799-19" data-line-number="19">  <span class="kw">expect_equal</span>(result, <span class="kw">c</span>(2L))</a>
<a class="sourceLine" id="cb799-20" data-line-number="20">})</a></code></pre></div>
<p>And here’s what happens when we run this file with <code>test_dir</code>:</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb800-1" data-line-number="1"><span class="kw">test_dir</span>(<span class="st">&quot;tests/testthat&quot;</span>, <span class="st">&quot;find_empty_b&quot;</span>)</a></code></pre></div>
<pre><code>✔ |  OK F W S | Context

⠏ |   0       | Finding empty rows
✔ |   3       | Finding empty rows

══ Results ═════════════════════════════════════════════════════════════════════
OK:       3
Failed:   0
Warnings: 0
Skipped:  0</code></pre>
</div>
<div id="how-can-i-check-data-transformation" class="section level2">
<h2><span class="header-section-number">8.6</span> How can I check data transformation?</h2>
<p>People normally write unit tests for the code in packages,
not to check the steps taken to clean up particular datasets,
but the latter are just as useful as the former.
To illustrate,
we have been given several more CSV files to clean up.
The first,
<code>at_health_facilities.csv</code>,
shows the percentage of births at health facilities by country, year, and mother’s age.
It comes from the same UNICEF website as our previous data,
but has a different set of problems.
Here are its first few lines:</p>
<pre><code>,,GLOBAL DATABASES,,,,,,,,,,,,,
,,[data.unicef.org],,,,,,,,,,,,,
,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,
Indicator:,Delivered in health facilities,,,,,,,,,,,,,,
Unit:,Percentage,,,,,,,,,,,,,,
,,,,Mother&#39;s age,,,,,,,,,,,
iso3,Country/areas,year,Total ,age 15-17,age 18-19,age less than 20,age more than 20,age 20-34,age 35-49,Source,Source year,,,,
AFG,Afghanistan,2010,   33 ,    25 ,    29 ,    28 ,    31 ,    31 ,    31 ,MICS,2010,,,,
ALB,Albania,2005,   98 ,    100 ,   96 ,    97 ,    98 ,    99 ,    92 ,MICS,2005,,,,
ALB,Albania,2008,   98 ,    94 ,    98 ,    97 ,    98 ,    98 ,    99 ,DHS,2008,,,,
...</code></pre>
<p>and its last:</p>
<pre><code>ZWE,Zimbabwe,2005,  66 ,    64 ,    64 ,    64 ,    67 ,    69 ,    53 ,DHS,2005,,,,
ZWE,Zimbabwe,2009,  58 ,    49 ,    59 ,    55 ,    59 ,    60 ,    52 ,MICS,2009,,,,
ZWE,Zimbabwe,2010,  64 ,    56 ,    66 ,    62 ,    64 ,    65 ,    60 ,DHS,2010,,,,
ZWE,Zimbabwe,2014,  80 ,    82 ,    82 ,    82 ,    79 ,    80 ,    77 ,MICS,2014,,,,
,,,,,,,,,,,,,,,
Definition:,Percentage of births delivered in a health facility.,,,,,,,,,,,,,,
,&quot;The indicator refers to women who had a live birth in a recent time period, generally two years for MICS and five years for DHS.&quot;,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,
Note:,&quot;Database include reanalyzed data from DHS and MICS, using a reference period of two years before the survey.&quot;,,,,,,,,,,,,,,
,Includes surveys which microdata were available as of April 2016. ,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,
Source:,&quot;UNICEF global databases 2016 based on DHS, MICS .&quot;,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,
Contact us:,data@unicef.org,,,,,,,,,,,,,,</code></pre>
<p>There are two other files in this collection called <code>c_sections.csv</code> and <code>skilled_attendant_at_birth.csv</code>,
which are the number of Caesarean sections
and the number of births where a midwife or other trained practitioner was present.
All three datasets have been exported from the same Excel spreadsheet;
rather than writing a separate script for each,
we should create a tool that will handle them all.</p>
<p>At first glance,
the problems we need to solve to do this are:</p>
<ol style="list-style-type: decimal">
<li>Each file may have a different number of header rows
(by inspection, two of the files have 7 and one has 8),
so we should infer this number from the file.</li>
<li>Each file may contain a different number of records,
so our tool should select rows by content rather than by absolute row number.</li>
<li>The files appear to have the same column names
(for which we give thanks),
but we should check this in case someone tries to use our function
with a dataset that doesn’t.</li>
</ol>
<p>These three requirements will make our program significantly more complicated,
so we should tackle each with its own testable function.</p>
<div id="how-can-i-reorganize-code-to-make-it-more-testable" class="section level3">
<h3><span class="header-section-number">8.6.1</span> How can I reorganize code to make it more testable?</h3>
<p>The data we care about comes after the row with <code>iso3</code>, <code>Country/areas</code>, and other column headers,
so the simplest way to figure out how many rows to skip is to read the data,
look for this row,
and discard everything above it.
The simplest way to do <em>that</em> is to read the file once to find the number of header rows,
then read it again,
discarding that number of rows.
It’s inefficient,
but for a dataset this size,
simplicity beats performance.</p>
<p>Here’s our first try:</p>
<div class="sourceCode" id="cb804"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb804-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;data/at_health_facilities.csv&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb804-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="dt">check =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb804-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb804-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(check <span class="op">==</span><span class="st"> &quot;iso3&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb804-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb804-6" data-line-number="6"><span class="st">  </span><span class="kw">first</span>()</a></code></pre></div>
<pre><code>Warning: Missing column names filled in: &#39;X1&#39; [1], &#39;X2&#39; [2], &#39;X4&#39; [4], &#39;X5&#39; [5],
&#39;X6&#39; [6], &#39;X7&#39; [7], &#39;X8&#39; [8], &#39;X9&#39; [9], &#39;X10&#39; [10], &#39;X11&#39; [11], &#39;X12&#39; [12],
&#39;X13&#39; [13], &#39;X14&#39; [14], &#39;X15&#39; [15], &#39;X16&#39; [16]</code></pre>
<pre><code>Parsed with column specification:
cols(
  X1 = col_character(),
  X2 = col_character(),
  `GLOBAL DATABASES` = col_character(),
  X4 = col_character(),
  X5 = col_character(),
  X6 = col_character(),
  X7 = col_character(),
  X8 = col_character(),
  X9 = col_character(),
  X10 = col_character(),
  X11 = col_character(),
  X12 = col_character(),
  X13 = col_logical(),
  X14 = col_logical(),
  X15 = col_logical(),
  X16 = col_logical()
)</code></pre>
<pre><code>[1] 7</code></pre>
<p>Ignoring the messages about missing column names,
this tells us that <code>iso3</code> appears in row 7 of our data,
which is <em>almost</em> true:
it’s actually in row 8,
because <code>read_csv</code> has interpreted the first row of the raw CSV data as a header.
On the bright side,
that means we can immediately use this value as the <code>skip</code> parameter to the next <code>read_csv</code> call.</p>
<p>How do we test this code?
Easy:
we turn it into a function,
tell that function to stop if it can’t find <code>iso3</code> in the data,
and write some unit tests.
The function is:</p>
<div class="sourceCode" id="cb808"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb808-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb808-2" data-line-number="2"></a>
<a class="sourceLine" id="cb808-3" data-line-number="3">determine_skip_rows &lt;-<span class="st"> </span><span class="cf">function</span>(src_path) {</a>
<a class="sourceLine" id="cb808-4" data-line-number="4">  <span class="kw">read_csv</span>(src_path) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb808-5" data-line-number="5"><span class="st">    </span><span class="kw">select</span>(<span class="dt">check =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb808-6" data-line-number="6"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb808-7" data-line-number="7"><span class="st">    </span><span class="kw">filter</span>(check <span class="op">==</span><span class="st"> &quot;iso3&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb808-8" data-line-number="8"><span class="st">    </span><span class="kw">select</span>(id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb808-9" data-line-number="9"><span class="st">    </span><span class="kw">first</span>()</a>
<a class="sourceLine" id="cb808-10" data-line-number="10">}</a></code></pre></div>
<p>We can then call <code>usethis::use_testthat()</code> to set up some testing infrastructure,
including the directory <code>tests/testthat</code>
and a script called <code>tests/testthat.R</code>
that will run all our tests when we want to check the integrity of our project.
Once we have done that
we can put these five tests in <code>tests/testthat/test_determine_skip_rows.R</code>:</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb809-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb809-2" data-line-number="2"><span class="kw">library</span>(testthat)</a>
<a class="sourceLine" id="cb809-3" data-line-number="3"><span class="kw">context</span>(<span class="st">&quot;Skipping rows correctly&quot;</span>)</a>
<a class="sourceLine" id="cb809-4" data-line-number="4"></a>
<a class="sourceLine" id="cb809-5" data-line-number="5"><span class="kw">source</span>(<span class="st">&quot;../../scripts/determine_skip_rows_a.R&quot;</span>)</a>
<a class="sourceLine" id="cb809-6" data-line-number="6"></a>
<a class="sourceLine" id="cb809-7" data-line-number="7"><span class="kw">test_that</span>(<span class="st">&quot;The right row is found when there are header rows&quot;</span>, {</a>
<a class="sourceLine" id="cb809-8" data-line-number="8">  result &lt;-<span class="st"> </span><span class="kw">determine_skip_rows</span>(<span class="st">&quot;a1,a2</span><span class="ch">\n</span><span class="st">b1,b2</span><span class="ch">\n</span><span class="st">is03,stuff</span><span class="ch">\n</span><span class="st">c1,c2</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb809-9" data-line-number="9">  <span class="kw">expect_equal</span>(result, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb809-10" data-line-number="10">})</a>
<a class="sourceLine" id="cb809-11" data-line-number="11"></a>
<a class="sourceLine" id="cb809-12" data-line-number="12"><span class="kw">test_that</span>(<span class="st">&quot;The right row is found when there are header rows and blank lines&quot;</span>, {</a>
<a class="sourceLine" id="cb809-13" data-line-number="13">  result &lt;-<span class="st"> </span><span class="kw">determine_skip_rows</span>(<span class="st">&quot;a1,a2</span><span class="ch">\n</span><span class="st">b1,b2</span><span class="ch">\n</span><span class="st">,</span><span class="ch">\n</span><span class="st">is03,stuff</span><span class="ch">\n</span><span class="st">c1,c2</span><span class="ch">\n</span><span class="st">,</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb809-14" data-line-number="14">  <span class="kw">expect_equal</span>(result, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb809-15" data-line-number="15">})</a>
<a class="sourceLine" id="cb809-16" data-line-number="16"></a>
<a class="sourceLine" id="cb809-17" data-line-number="17"><span class="kw">test_that</span>(<span class="st">&quot;The right row is found when there are no header rows to discard&quot;</span>, {</a>
<a class="sourceLine" id="cb809-18" data-line-number="18">  result &lt;-<span class="st"> </span><span class="kw">determine_skip_rows</span>(<span class="st">&quot;iso3,stuff</span><span class="ch">\n</span><span class="st">c1,c2</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb809-19" data-line-number="19">  <span class="kw">expect_equal</span>(result, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb809-20" data-line-number="20">})</a>
<a class="sourceLine" id="cb809-21" data-line-number="21"></a>
<a class="sourceLine" id="cb809-22" data-line-number="22"><span class="kw">test_that</span>(<span class="st">&quot;No row is found when &#39;iso3&#39; isn&#39;t present&quot;</span>, {</a>
<a class="sourceLine" id="cb809-23" data-line-number="23">  <span class="kw">expect_error</span>(<span class="kw">determine_skip_rows</span>(<span class="st">&quot;a1,a2</span><span class="ch">\n</span><span class="st">b1,b1</span><span class="ch">\n</span><span class="st">&quot;</span>),</a>
<a class="sourceLine" id="cb809-24" data-line-number="24">               <span class="st">&quot;No start row found&quot;</span>)</a>
<a class="sourceLine" id="cb809-25" data-line-number="25">})</a>
<a class="sourceLine" id="cb809-26" data-line-number="26"></a>
<a class="sourceLine" id="cb809-27" data-line-number="27"><span class="kw">test_that</span>(<span class="st">&quot;No row is found when &#39;iso3&#39; is in the wrong place&quot;</span>, {</a>
<a class="sourceLine" id="cb809-28" data-line-number="28">  <span class="kw">expect_error</span>(<span class="kw">determine_skip_rows</span>(<span class="st">&quot;stuff,iso3</span><span class="ch">\n</span><span class="st">&quot;</span>),</a>
<a class="sourceLine" id="cb809-29" data-line-number="29">               <span class="st">&quot;No start row found&quot;</span>)</a>
<a class="sourceLine" id="cb809-30" data-line-number="30">})</a></code></pre></div>
<p>and run it:</p>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb810-1" data-line-number="1"><span class="kw">test_dir</span>(<span class="st">&quot;tests/testthat&quot;</span>, <span class="st">&quot;determine_skip_rows_a&quot;</span>)</a></code></pre></div>
<pre><code>✔ |  OK F W S | Context

⠏ |   0       | Skipping rows correctly
✖ |   0 5     | Skipping rows correctly
────────────────────────────────────────────────────────────────────────────────
test_determine_skip_rows_a.R:9: failure: The right row is found when there are header rows
`result` not equal to 2.
Lengths differ: 0 is not 1

test_determine_skip_rows_a.R:14: failure: The right row is found when there are header rows and blank lines
`result` not equal to 3.
Lengths differ: 0 is not 1

test_determine_skip_rows_a.R:19: failure: The right row is found when there are no header rows to discard
`result` not equal to 0.
Lengths differ: 0 is not 1

test_determine_skip_rows_a.R:23: failure: No row is found when &#39;iso3&#39; isn&#39;t present
`determine_skip_rows(&quot;a1,a2\nb1,b1\n&quot;)` did not throw an error.

test_determine_skip_rows_a.R:28: failure: No row is found when &#39;iso3&#39; is in the wrong place
`determine_skip_rows(&quot;stuff,iso3\n&quot;)` did not throw an error.
────────────────────────────────────────────────────────────────────────────────

══ Results ═════════════════════════════════════════════════════════════════════
OK:       0
Failed:   5
Warnings: 0
Skipped:  0</code></pre>
<p>That’s right: all five fail.
The first problem is that we have written <code>is03</code> (with a digit <code>0</code> instead of a letter <code>o</code>) in the first two tests.
If we fix that and re-run the tests, they pass;
what about the other three?</p>
<ol style="list-style-type: decimal">
<li>When there are no rows to skip, our function is returning <code>integer(0)</code> instead of 0
because the row with <code>iso3</code> is being used as headers.</li>
<li>When <code>iso3</code> isn’t found at all, the function is returning <code>integer(0)</code> rather than stopping.</li>
</ol>
<p>Here is a more robust version of the function:</p>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb812-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb812-2" data-line-number="2"></a>
<a class="sourceLine" id="cb812-3" data-line-number="3">determine_skip_rows &lt;-<span class="st"> </span><span class="cf">function</span>(src_path) {</a>
<a class="sourceLine" id="cb812-4" data-line-number="4">  data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(src_path)</a>
<a class="sourceLine" id="cb812-5" data-line-number="5">  <span class="cf">if</span> (<span class="kw">names</span>(data)[<span class="dv">1</span>] <span class="op">==</span><span class="st"> &quot;iso3&quot;</span>) {</a>
<a class="sourceLine" id="cb812-6" data-line-number="6">    <span class="kw">return</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb812-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb812-8" data-line-number="8">  result &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-9" data-line-number="9"><span class="st">    </span><span class="kw">select</span>(<span class="dt">check =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-10" data-line-number="10"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-11" data-line-number="11"><span class="st">    </span><span class="kw">filter</span>(check <span class="op">==</span><span class="st"> &quot;iso3&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-12" data-line-number="12"><span class="st">    </span><span class="kw">select</span>(id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-13" data-line-number="13"><span class="st">    </span><span class="kw">first</span>()</a>
<a class="sourceLine" id="cb812-14" data-line-number="14">  <span class="cf">if</span> (<span class="kw">length</span>(result) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb812-15" data-line-number="15">    <span class="kw">stop</span>(<span class="st">&quot;No start row found in&quot;</span>, src_path)</a>
<a class="sourceLine" id="cb812-16" data-line-number="16">  }</a>
<a class="sourceLine" id="cb812-17" data-line-number="17">  result</a>
<a class="sourceLine" id="cb812-18" data-line-number="18">}</a></code></pre></div>
<p>And here are the results:</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb813-1" data-line-number="1"><span class="kw">test_dir</span>(<span class="st">&quot;tests/testthat&quot;</span>, <span class="st">&quot;determine_skip_rows_b&quot;</span>)</a></code></pre></div>
<pre><code>✔ |  OK F W S | Context

⠏ |   0       | Skipping rows correctly
✔ |   5       | Skipping rows correctly

══ Results ═════════════════════════════════════════════════════════════════════
OK:       5
Failed:   0
Warnings: 0
Skipped:  0</code></pre>
<p>Our tests still aren’t checking anything statistical,
but without trustworthy data,
our statistics will be meaningless.
Tests like these allow our future selves to focus on making new mistakes instead of repeating old ones.</p>
</div>
</div>
<div id="key-points-6" class="section level2">
<h2><span class="header-section-number">8.7</span> Key Points</h2>
<ul>
<li>Operations signal conditions in R when errors occur.</li>
<li>The three built-in levels of conditions are messages, warnings, and errors.</li>
<li>Programs can signal these themselves using the functions <code>message</code>, <code>warning</code>, and <code>stop</code>.</li>
<li>Operations can be placed in a call to the function <code>try</code> to suppress errors, but this is a bad idea.</li>
<li>Operations can be placed in a call to the function <code>tryCatch</code> to handle errors.</li>
<li>Use testthat to write unit tests for R.</li>
<li>Put unit tests for an R package in the <code>tests/testthat</code> directory.</li>
<li>Put tests in files called <code>test_<em>group</em>.R</code> and call them <code>test_<em>something</em></code>.</li>
<li>Use <code>test_dir</code> to run tests from a particular that match a pattern.</li>
<li>Write tests for data transformation steps as well as library functions.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="debt.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="advanced.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/gvwilson/tidynomicon/edit/master/testerror.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/gvwilson/tidynomicon/edit/master/testerror.Rmd",
"text": null
},
"download": ["r4de.pdf", "r4de.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
